# Elastic Stack Chapter 3 - Kibana

<hr>

### Kibana
* Kibana - 엘라스틱서치에 저장된 데이터를 시각화하는 `데이터 파이프라인` 중의 하나
* 특징
    * 오픈소스 시각화 데이터 플랫폼
    * ES에 저장된 데이터를 시각화

### Discover
* 엘라스틱서치에 인덱싱된 데이터는 키바나의 Discover에서 확인할 수 있음
* 주요 UI 설명
  * 도큐먼트 테이블은 엘라스틱서치에 인덱싱된 데이터를 키바나의 인덱스 패턴에 지정된 타임스탬프 값에 따라 나열
  * 히스토그램은 인덱스 패턴에 지정된 타임스탬프 값을 기준으로 시간별 유입된 데이터 양을 확인하고 쿼리 바를 통해서 원하는 데이터를 질의 가능
* 타임피커
  * 타임피커는 Discover 뿐만 아니라 키바나 전역에서 사용하는 시간 값이자 엘라스틱서치에 요청할 데이터의 시간 범위
  * Quick은 사용하는 시간 범위 설정 
  * Relative은 Quick보다 세밀하게 설정 가능
  * Absolute 타임피커 옵션 중에서 가장 세밀하게 설정 가능
* 툴바
  * 툴바는 응용 프로그램에서 자주 사용되는 명령어를 모아 만든 아이콘
  * `Filter`는 루씬의 쿼리 문법 대신 필터를 설정하는 폼을 통해서 필드와 조건을 선택하고 값을 입력해 필터를 생성 
  * `ES Query DSL JSON` 형식을 통해서 필터를 생성하는 기능
* 도큐먼트 테이블
  * 엘라스틱서치로부터 반환되는 데이터가 표시되는 영역
  * `도큐먼트 테이블 Table 탭`은 JSON 포맷을 한결 보기 편하게 시각화하는 기능
  * `도큐먼트 테이블 JSON 탭`은 JSON 포맷을 한결 보기 편하게 시각화하는 기능
  * `Discover의 Fields 항목`은 인덱스 패턴을 선택하는 박스가 있어 인덱스 패턴에 대한 도큐먼트 테이블이 표시

### 시각화
* 키바나의 시각화 기능은 ES에 인덱싱된 데이터를 집계해 시각화한다.
  * 시각화 오브젝트 유형
    1. 기본 차트: 라인 차트, 영역 차트, 바 차트, 히트맵 차트
    2. 데이터: 데이터 테이블, 매트릭, 게이지
    3. 지도: 좌표 지도, 지역 지도
    4. 시계열: 타임라이언, 타임 시리즈
    5. 기타: 태그 클라우드, 마크다운 위젯, 베가 그래프
* 영역, 라인, 막대형 차트
  * `Visualize` 페이지에서 Line 차트를 선택하고 인덱스 패턴을 선택하면 옵션 페이지가 나타남
  * `Data 탭`은 실제로 차트에 반영할 데이터를 설정하는 Y축의 값은 집계 유형이고 선택 가능한 집계는 Sum, Avg, Count같은 메트릭 애그리게이션이고 X축 값이 될 버킷의 유형은 Y축 설정에서 집계한 상위 집계로 Date range, Date Histogram같은 버킷 애그리케이션을 지정  
  * `Metric & Axes 탭`에서는 차트에 표시되는 각 매트릭의 표시 방법을 설정
  * `오브젝트 저장` Save 버튼을 통해서 대시보드 작성을 위한 오브젝트 저장
* 히트맵
  * `Visualize` 페이지에서 인덱스 패턴을 선택하면 옵션 페이지들이 나타남
  * `Data 탭` 매트릭 어그리게이션을 통해서 엘라스틱 서치에 인덱싱된 데이터나 버킷에 대한 정보를 설정
  * `Options 탭` 차트에서 보이는 영역에 대한 설정
  * `오브젝트 저장` 
* 파이 차트
  * `Visualize` 페이지에서 인덱스 패턴을 선택하면 옵션 페이지가 나타남 
  * `Data 탭`은 차트에 반영할 데이터를 설정
  * `Metric & Axes 탭`은 Metric은 인덱싱된 수치 데이터를 차트에 어떻게 표시할지를 설정하고 Buckets는 Y축의 집계 결과에 대해서 구분과 표시 방법을 설정
  * `Options 탭`은 세부 설정을 하는 곳
  * `오브젝트 저장`
* 데이터 테이블
  * `Visualize` 페이지에서 인덱스 패턴을 선택하면 옵션 페이지가 나타남 
  * `Data 탭`은 차트에 반영할 데이터를 설정
  * `Options 탭` 차트의 보여지는 부분 세부 설정
  * `오브젝트 저장`
* 메트릭
  * `Data 탭`은 차트에 반영할 데이터를 설정
  * `오브젝트 저장`
* 게이지/골
  * `Data 탭`은 차트에 반영할 데이터를 설정
  * `오브젝트 저장`
* 좌표 지도
  * `Data 탭`은 차트에 반영할 데이터를 설정
  * `오브젝트 저장`
* 지역 지도
  * `Data 탭`은 차트에 반영할 데이터를 설정
  * `오브젝트 저장`
* 태그 클라우드
  * `Data 탭`은 차트에 반영할 데이터를 설정
  * `Options 탭` 차트의 보여지는 부분 세부 설정
  * `오브젝트 저장`

### 타임라이언
* 시계열 차트 중의 하나로 일반 시계열 차트와 달리 표현식을 사용할 수 있어서 유용
* 특징
  * 조건문 사용 가능
  * 쿼리로 데이터를 조회하고 시계열 데이터로 나타내고 변환하여 시각화 과정을 한번에 처리
  * 대시보드에서 직접 수치나 조건을 변경하고 결과 확인이 가능
* 타임라이언 함수 사용
  * 타임 라이언 함수의 구조
  ```
  .es(*)
  ```
  es는 함수명이고 *에는 인자가 들어감
  * .es 함수는 엘라스틱 서치에서 데이터를 가져오는 함수로 매개변수를 이용하여 설정 가능
  * .label 함수는 차트를 중첩시킬 때의 문제를 해결하는 함수로 각 시리즈에 라벨을 설정하고 레전드의 시리즈에 색 삽입이 가능
  * .lines 함수는 Timelion 함수로 차트 모양을 직접 정의할수 있음
* 조건 설정
  * .if 함수는 집계한 데이터를 기반으로 동작하는데 조건을 만족하면, then을 실행
* 값 변환
  * .multiply 함수와 .dvide 함수를 사용하면 값 변환이 가능

### Dashboard
* 대시보드는 앞서 저장한 시각화 오브젝트의 모음
* 대시보드 저장 및 임포트와 익스포트
  * 키바나는 대시보드나 시각화 설정을 담은 JOSN 파일을 익스포트나 임포트가 가능
