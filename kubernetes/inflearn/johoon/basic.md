# Kubernetes 정리 자료
쉽게 시작하는 쿠버네티스 강의를 정리하여 만들었습니다.

Table of Contents
=================
<!--ts-->
   * [쿠버네티스 환경 구성](#쿠버네티스-환경-구성)
   * [배포를 통한 쿠버네티스 체험](#배포를-통한-쿠버네티스-체험)
   * [쿠버네티스 인사이드](#쿠버네티스-인사이드)
   * [문제를 통해 배우는 쿠버네티스](#문제를-통해-배우는-쿠버네티스)
   * [쿠버네티스 오브젝트](#쿠버네티스-오브젝트)
<!--te-->

쿠버네티스
=======
- `쿠버네티스`
  - 컨테이너(도커)를 관리하는 툴
- `도커`
  - 하이퍼바이저를 사용하는 가상화 환경과 다르게 하이퍼바이저를 사용하지 않고 운영체제 위에 바로 애플리케이션 구동하게하는 툴

배포를 통한 쿠버네티스 체험
=======
- `Pod`
  - 컨테이너의 집합, 대부분 하나의 컨테이너가 하나의 파드로 이루어짐
  - 파드 속 컨테이너에 볼륨(저장 공간)을 추가 가능
- `Service`
  - 쿠버네티스 클러스터는 외부와 통신하기 위해 노드를 통해서 파드를 외부에 노출 시키는데 연결하는 네트워크 오브젝트
  - 각 파드는 NodePort(L7), LoadBalancer(L7)로 노드 노출 설정 가능
  - NodePort는 IP를 특정하고 노출하기 때문에 보안적으로 취약하여 이를 보완해서 LoadBalancer는 EXTERNAL IP를 만들고 이를 통해 외부에 노출시키는 설정 방법
- `Deployment`
  - 파드를 배포하는 오브젝트로 업데이트 및 버전을 관리
  - ReplicaSet과 함께 사용하여 scale 할 수 있음
  - Deployment는 서비스 설정을 LoadBalancer로 설정해서 배포

쿠버네티스 인사이드
=======
- `쿠버네티스 구성`
  - apiserver: 상태를 바꾸거나 조회하는 중앙 모듈로 etcd와 유일하게 통신함
  - etcd: 모든 상태와 데이터를 저장
  - controll manager: 끊임 없이 상태를 체크하고 원하는 상태를 유지
  - scheduler: 새로 생성된 Pod을 감지하고 실행할 노드를 선택
  - coreDNS: 쿠버네티스 클러스터의 DNS 역할을 수행할 수 있는 DNS 서버
  - proxy: Pod으로 연결되는 네트워크를 관리, 초기에는 kube-proxy 자체가 프록시 서버로 동작하면서 실제 요청을 프록시 서버가 받고 각 Pod에 전달해 주었는데 시간이 지나면서 iptables 또는 IPVS를 사용
  - kubelet: Pod을 실행/중지하고 상태를 체크
- `쿠버네티스 기본 철학`
  - 기본적으로 항상 상태를 감시하고 있는데, 상태 값에 변경을 줄 때마다 etcd에 상태 값을 저장하고 상태 값과 현재 상태를 맞추는 방식으로 동작

문제를 통해 배우는 쿠버네티스
=======
- `파드에 문제가 생긴 경우`
  - 단순 파드는 지워지면 재생성되지 않지만, Deployment 형태로 파드가 배포된 경우 지워져도 재생성
- `워커 노드에 문제가 생긴 경우`
  - 워커 노드의 kubelet에 삭제된 생긴 경우 파드가 죽고 Pending 상태
  - 워커 노드의 컨테이너 런타임(도커)가 중단된 경우 스케줄러와 통신할 수 있기 때문에 해당 워커 노드를 제외하고 밸런싱 처리됨
- `마스터 노드에 문제가 생긴 경우`
  - 마스터 노드의 스케줄러가 삭제된 경우 재생성
  - 마스터 노드의 kubelet가 중단된 경우 통신을 할 수가 없어 삭제가 수행되지 않고 워커 노드와 마스터 노드의 기능도 문제가 없음
  - 마스터 노드의 컨테이너 런타임(도커)가 중단된 경우 apiserver를 핸들링 할 수가 없어 시스템 전체가 마비

쿠버네티스 오브젝트
=======
- `쿠버네티스 오브젝트`
  - pod: 컨테이너의 집합
  - service: 쿠버네티스 클러스터는 외부와 통신하기 위해 노드를 통해서 파드를 외부에 노출 시키는데 연결하는 네트워크 오브젝트
  - namespace: 동일한 물리 클러스터를 기반으로 하는 여러 가상 클러스터 구분
  - volume: 영속적인 데이터 저장을 위한 스토리지 오브젝트
